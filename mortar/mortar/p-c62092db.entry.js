import{r as s,c as t,h as i,g as h}from"./p-77e8c3a9.js";import"./p-74149bb1.js";import{c as e}from"./p-49401b94.js";const o=class{constructor(i){s(this,i),this.size="md",this.label="",this.help="",this.haserror=!1,this.error="",this.placeholder="",this.disabled=!1,this.open=!1,this.focused=!1,this.highlight=-1,this.value=null,this.options=[],this.optionsKeys={value:"value",label:"label",disabled:"disabled"},this.className=()=>e("dropdown-outer",`${this.size}`,{"is-open":this.open,"is-focused":this.focused,"is-disabled":this.disabled,"has-error":this.haserror}),this.dropClassName=()=>e("dropdown-list","dropdown-list-dropdown",{"is-active":this.open}),this.displayClassName=()=>e("dropdown-item","dropdown-item-selectable",{"dropdown-placeholder":!this.value}),this.handleClick=()=>{this.disabled||(this.open=!this.open)},this.handleFocus=()=>{this.disabled||(this.focused=!0)},this.handleBlur=()=>{this.disabled||(this.focused=!1,this.open=!1)},this.handleItemSelect=s=>{s[this.optionsKeys.disabled]||(this.value=s,this.itemSelect.emit(s),this.open=!1)},this.handleDropdownRef=s=>{this.dropdownEl=s},this.loadOptions=()=>{Array.prototype.slice.call(this.el.querySelectorAll("option")).forEach(s=>{const t=s.innerHTML,i=s.getAttribute("value"),h=s.getAttribute("disabled"),e=s.getAttribute("selected"),o={};o[this.optionsKeys.label]=t||i||"",o[this.optionsKeys.value]=i||t||"",o[this.optionsKeys.disabled]=null!==h,this.options.push(o),null!==e&&null===h&&(this.value=o),this.el.removeChild(s)})},this.getAvailable=()=>this.options.map((s,t)=>({o:s,k:t})).filter(s=>!s.o[this.optionsKeys.disabled]),this.clearHighlight=()=>{this.highlight=-1},this.setHighlight=s=>{const t=this.getAvailable();if(s)if(-1===this.highlight)if(this.value){const s=t.find(s=>this.value[this.optionsKeys.value]===s.o[this.optionsKeys.value]);this.highlight=s?s.k:t[0].k}else this.highlight=t[0].k;else{const s=t.find(s=>s.k>this.highlight);this.highlight=s?s.k:-1}else{const s=t.reverse();if(-1===this.highlight)if(this.value){const t=s.find(s=>this.value[this.optionsKeys.value]===s.o[this.optionsKeys.value]);this.highlight=t?t.k:s[0].k}else this.highlight=s[0].k;else{const t=s.find(s=>s.k<this.highlight);this.highlight=t?t.k:-1}}if(this.highlight>=0){const s=this.el.querySelector('.dropdown-list[role="listbox"]'),t=this.el.querySelector(`mortar-dropdown-item:nth-child(${this.highlight+1})`);s.scrollTop=t.offsetTop}},this.selectHighlight=()=>{this.highlight>-1&&this.handleItemSelect(this.options[this.highlight])},this.itemSelect=t(this,"itemSelect",7)}handleOutsideClick(s){this.open&&s.target!==this.dropdownEl&&!this.dropdownEl.contains(s.target)&&(this.open=!1)}componentWillLoad(){this.loadOptions()}handleOpen(s){if(s){if(this.value){const s=this.options.findIndex(s=>s.value===this.value.value&&s.label===this.value.label);if(s>=0){const t=this.el.querySelector('.dropdown-list[role="listbox"]'),i=this.el.querySelector(`mortar-dropdown-item:nth-child(${s+1})`);t.scrollTop=i.offsetTop}}}else this.clearHighlight()}handleKeySelect(s){this.open?(38===s.keyCode&&(s.preventDefault(),this.setHighlight(!1)),40===s.keyCode&&(s.preventDefault(),this.setHighlight(!0)),13!==s.keyCode&&32!==s.keyCode||(s.preventDefault(),this.selectHighlight(),this.open=!1),27===s.keyCode&&(s.preventDefault(),this.open=!1)):this.focused&&(13!==s.keyCode&&32!==s.keyCode||(s.preventDefault(),this.open=!0))}render(){return i("mortar-form-element",{label:this.label,help:this.help,haserror:this.haserror,error:this.error,elementclass:"dropdown",ref:this.handleDropdownRef},i("div",{class:this.className(),tabindex:"0",role:"listbox","aria-haspopup":"true","aria-expanded":this.open,onFocus:this.handleFocus,onBlur:this.handleBlur},i("div",{class:"dropdown-inner",onClick:this.handleClick},i("div",{class:"dropdown-list dropdown-list-single"},i("div",{class:this.displayClassName(),"aria-selected":"true"},this.value?this.value[this.optionsKeys.label]:this.placeholder))),i("div",{class:this.dropClassName(),"aria-expanded":this.open},i("div",{class:"dropdown-list",role:"listbox"},this.options.map((s,t)=>i("mortar-dropdown-item",{highlighted:this.highlight===t,selected:this.highlight>-1?this.highlight===t:this.value&&this.value.value===s.value,disabled:s[this.optionsKeys.disabled],label:s[this.optionsKeys.label],onClick:()=>this.handleItemSelect(s)}))))))}get el(){return h(this)}static get watchers(){return{open:["handleOpen"]}}},l=class{constructor(t){s(this,t),this.disabled=!1,this.highlighted=!1,this.selected=!1,this.label="",this.className=()=>e("dropdown-item","dropdown-item-choice",{"dropdown-item-selectable":!this.disabled,"dropdown-item-disabled":this.disabled,"is-highlighted":!this.disabled&&this.highlighted})}render(){return i("div",{class:this.className(),role:"option","aria-selected":this.selected},this.label)}},r=class{constructor(t){s(this,t),this.elementclass="",this.label="",this.haserror=!1,this.error="",this.help="",this.legend="",this.disabled=!1,this.legendId="",this.name=""}render(){return i("fieldset",{class:this.elementclass,disabled:this.disabled},this.label&&i("label",{htmlFor:this.name},this.label),this.legend&&i("legend",{id:this.legendId},this.legend),i("slot",null),this.help&&i("div",{class:"helper-message show"},this.help),this.haserror&&i("div",{class:"error-message show",role:"alert"},this.error))}};export{o as mortar_dropdown,l as mortar_dropdown_item,r as mortar_form_element}